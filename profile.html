<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - GameJoint</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

    <header>
        <div class="container">
            <div class="row header-content">
                <div class="col-2">
                    <a href="homepage-member.html" class="logo-link">
                        <img src="assets/images/logo.svg" alt="GameJoint Logo" class="site-logo">
                    </a>
                </div>
                <div class="col-10">
                    <nav>
                        <ul class="nav-left">
                            <li><a href="index.html">Games</a></li>
                        </ul>
                        <div class="search-container">
                            <form action="#">
                                <input type="text" placeholder="Search games..." name="search">
                                <button type="submit">Search</button>
                            </form>
                        </div>
                        <ul class="nav-right">
                            <li><a href="profile.html">My Profile (Kidboo05)</a></li>
                            <li><a href="index.html" class="nav-logout">Logout</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="container main-content">
        
        <div class="row">
            <div class="col-12">
                <h1>Kidboo05</h1>
                <span class="release-date">Member Since Dec 2023</span>
            </div>
        </div>
        <hr>

        <div class="row mt-30 mb-30">
            <div class="col-12">
                <h4 class="font-weight-bold mb-15">My Review Stats</h4>
                <div class="game-card overview-card">
                    <div class="overview-left">
                        <div id="avg-score" class="overview-score-large">-</div>
                        <div class="overview-label">Avg. Score</div>
                    </div>
                    <div class="overview-right">
                        <h6 class="overview-title">Score Distribution</h6>
                        <div class="mb-20">
                            <div class="dist-row">
                                <span class="dist-label">Positive</span>
                                <div class="dist-track">
                                    <div id="pos-bar" class="dist-fill bg-pos" style="width: 0%;"></div>
                                </div>
                                <span id="pos-count" class="dist-count">0</span>
                            </div>
                            <div class="dist-row">
                                <span class="dist-label">Mixed</span>
                                <div class="dist-track">
                                    <div id="mixed-bar" class="dist-fill bg-mix" style="width: 0%;"></div>
                                </div>
                                <span id="mixed-count" class="dist-count">0</span>
                            </div>
                            <div class="dist-row">
                                <span class="dist-label">Negative</span>
                                <div class="dist-track">
                                    <div id="neg-bar" class="dist-fill bg-neg" style="width: 0%;"></div>
                                </div>
                                <span id="neg-count" class="dist-count">0</span>
                            </div>
                        </div>
                        <hr class="divider-light">
                        <div class="row">
                            <div class="col-6">
                                <span class="high-low-label">Highest Rated</span>
                                <div class="high-low-row">
                                    <div id="highest-score-val" class="metascore metascore-mini">-</div>
                                    <b id="highest-game-name" class="game-name-small">-</b>
                                </div>
                            </div>
                            <div class="col-6">
                                <span class="high-low-label">Lowest Rated</span>
                                <div class="high-low-row">
                                    <div id="lowest-score-val" class="metascore metascore-mini">-</div>
                                    <b id="lowest-game-name" class="game-name-small">-</b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>

        <div class="row">
            <div class="col-12">
                
                <div class="section-title-row">
                    <h3 class="h3-nomargin">My Reviews</h3>
                    
                    <div class="filter-group">
                        <select onchange="filterReviews('profile-review-list', this.value)" class="filter-select">
                            <option value="all">Show All</option>
                            <option value="green">Positive (Green)</option>
                            <option value="yellow">Mixed (Yellow)</option>
                            <option value="red">Negative (Red)</option>
                        </select>

                        <select onchange="sortReviews('profile-review-list', this.value)" class="filter-select">
                            <option value="desc">Best Score</option>
                            <option value="asc">Worst Score</option>
                            <option value="date-desc">Newest First</option>
                            <option value="date-asc">Oldest First</option>
                        </select>
                    </div>
                </div>

                <div id="profile-review-list">
                    
                    <div class="game-card review-item review-item-auto" data-score="10">
                        <div class="card-content">
                            <div class="review-date-small">DEC 25, 2025</div>
                            <div class="review-item-header">
                                <div class="detailmetascore metascore-large mr-10">10</div>
                                <span class="review-game-title review-title-large">Baldur's Gate 3</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                Simply the best RPG I have ever played. The freedom of choice is insane.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">PC</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="9">
                        <div class="card-content">
                            <div class="review-date-small">DEC 19, 2025</div>
                            <div class="review-item-header">
                                <div class="detailmetascore metascore-large mr-10">9</div>
                                <span class="review-game-title review-title-large">PokÃ©mon Legends: Z-A</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                This DLC is not fun at all... wait, actually I loved the base game but the DLC was mixed. (Sample text)
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">SWITCH 2</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="4">
                        <div class="card-content">
                            <div class="review-date-small">NOV 10, 2025</div>
                            <div class="review-item-header">
                                <div class="detailmetascore metascore-large mr-10">4</div>
                                <span class="review-game-title review-title-large">Broken Racer 2025</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                Crashes constantly. Do not buy.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">PS5</span>
                            </div>
                        </div>
                    </div>

                </div>
                
                <div class="text-center mt-30">
                    <button class="btn-show-more" data-target="profile-review-list">Show More Reviews</button>
                </div>
            </div>
        </div>
    </div>

    <div id="full-review-modal" class="modal-overlay">
        <div class="modal-content modal-content-profile">
            <span class="close-full-review-btn modal-close-right">&times;</span>
            <div class="modal-review-header">
                <div id="modal-review-score" class="detailmetascore mr-15" style="width:50px; height:50px; line-height:50px; font-size:22px;"></div>
                <h3 id="modal-review-author" class="h3-nomargin">Game Title</h3>
            </div>
            <p id="modal-review-text" class="modal-text-content">Review text...</p>
            <div class="text-right mt-20">
                <button id="close-full-review-btn" class="btn-cancel" style="background: #333;">Close</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 GameJoint.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Run stats update
            updateOverviewStats();
            
            // Initial Sort
            if (typeof window.sortReviews === "function") {
                window.sortReviews('profile-review-list', 'date-desc');
            }
            
            // Filter Listeners
            const selects = document.querySelectorAll('select');
            selects.forEach(sel => {
                sel.addEventListener('change', () => {
                    setTimeout(updateOverviewStats, 100);
                });
            });
            
            // Run Read More Init (With Delay for Safety)
            setTimeout(initReadMoreButtons, 100);
            
            // Re-check read more buttons on resize
            window.addEventListener('resize', initReadMoreButtons);
        });

        // Coloring Logic
        function applyColorToEl(el, score) {
            el.classList.remove('score-none', 'score-dark-green', 'score-green', 'score-yellow', 'score-red');
            
            // Normalize score to 1-100 scale for checking
            let effective = score;
            if (score <= 10) effective = score * 10;

            if (effective >= 90) el.classList.add('score-dark-green');
            else if (effective >= 75) el.classList.add('score-green');
            else if (effective >= 50) el.classList.add('score-yellow');
            else el.classList.add('score-red');
        }

        // Stats Logic
        function updateOverviewStats() {
            const reviews = document.querySelectorAll('.review-item');
            
            let total = 0, pos = 0, mixed = 0, neg = 0, hi = -1, lo = 1000, hiG = "-", loG = "-";
            let validCount = 0;

            reviews.forEach(r => {
                // Check both box (metascore) and circle (detailmetascore)
                let sBox = r.querySelector('.metascore') || r.querySelector('.detailmetascore');
                if(!sBox) return;

                let s = parseFloat(sBox.innerText);
                const tElement = r.querySelector('.review-game-title');
                const t = tElement ? tElement.innerText : "-";
                
                if (!isNaN(s)) {
                    // Normalize to 100 scale for stats
                    let effectiveS = s <= 10 ? s * 10 : s;

                    total += effectiveS;
                    validCount++;
                    if (effectiveS >= 75) pos++; else if (effectiveS >= 50) mixed++; else neg++;
                    
                    if (effectiveS > hi) { hi = effectiveS; hiG = t; }
                    if (effectiveS < lo) { lo = effectiveS; loG = t; }
                }
            });

            if (validCount > 0) {
                // Show Global Avg (normalized to 100)
                document.getElementById('avg-score').innerText = Math.round(total / validCount);
                
                document.getElementById('pos-count').innerText = pos;
                document.getElementById('mixed-count').innerText = mixed;
                document.getElementById('neg-count').innerText = neg;
                
                document.getElementById('pos-bar').style.width = (pos/validCount*100)+'%';
                document.getElementById('mixed-bar').style.width = (mixed/validCount*100)+'%';
                document.getElementById('neg-bar').style.width = (neg/validCount*100)+'%';
                
                const hiEl = document.getElementById('highest-score-val');
                const loEl = document.getElementById('lowest-score-val');
                
                // Display High/Low as they appeared (10 or 95)
                hiEl.innerText = (hi % 10 === 0 && hi <= 100 && reviews[0].querySelector('.detailmetascore')) ? hi/10 : hi; 
                loEl.innerText = (lo % 10 === 0 && lo <= 100 && reviews[0].querySelector('.detailmetascore')) ? lo/10 : lo;

                document.getElementById('highest-game-name').innerText = hiG;
                document.getElementById('lowest-game-name').innerText = loG;

                applyColorToEl(hiEl, hi);
                applyColorToEl(loEl, lo);
            }
        }

        function initReadMoreButtons() {
            const modal = document.getElementById('full-review-modal');
            const modalAuthor = document.getElementById('modal-review-author');
            const modalScore = document.getElementById('modal-review-score');
            const modalText = document.getElementById('modal-review-text');

            document.querySelectorAll('.btn-read-more').forEach(btn => {
                const p = btn.previousElementSibling;
                
                // FIX: Add 5px buffer and check if 'p' exists
                if (p && p.scrollHeight > p.clientHeight + 5) {
                    btn.style.display = 'inline-block';
                } else {
                    btn.style.display = 'none';
                }

                // Remove old listener to prevent duplicates if function runs twice
                btn.onclick = null; 

                btn.onclick = function(e) {
                    e.preventDefault();
                    const card = btn.closest('.game-card');
                    const title = card.querySelector('.review-game-title').textContent;
                    
                    const scoreBox = card.querySelector('.metascore') || card.querySelector('.detailmetascore');
                    const score = scoreBox ? scoreBox.textContent : "-";

                    modalAuthor.textContent = title;
                    modalText.textContent = p.textContent.trim();
                    
                    // Style modal score to match (circle vs square)
                    modalScore.className = scoreBox.className;
                    modalScore.classList.remove('mr-10', 'metascore-large', 'mr-15'); 
                    modalScore.textContent = score;
                    
                    // Enforce large size for modal
                    modalScore.style.width = "50px";
                    modalScore.style.height = "50px";
                    modalScore.style.lineHeight = "50px";
                    modalScore.style.fontSize = "22px";
                    
                    applyColorToEl(modalScore, parseFloat(score));
                    modal.style.display = 'flex';
                };
            });

            const close = () => modal.style.display = 'none';
            if(document.querySelector('.close-full-review-btn')) document.querySelector('.close-full-review-btn').onclick = close;
            if(document.getElementById('close-full-review-btn')) document.getElementById('close-full-review-btn').onclick = close;
            window.onclick = (e) => { if (e.target == modal) close(); };
        }
    </script>
</body>
</html>