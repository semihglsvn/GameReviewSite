<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - GameJoint</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

    <header>
        <div class="container">
            <div class="row header-content">
                <div class="col-2">
                    <a href="homepage-member.html" class="logo-link">
                        <img src="assets/images/logo.svg" alt="GameJoint Logo" class="site-logo">
                    </a>
                </div>
                <div class="col-10">
                    <nav>
                        <ul class="nav-left">
                            <li><a href="#">Games</a></li>
                        </ul>
                        <div class="search-container">
                            <form action="#">
                                <input type="text" placeholder="Search games..." name="search">
                                <button type="submit">Search</button>
                            </form>
                        </div>
                        <ul class="nav-right">
                            <li><a href="profile.html">My Profile (GameJoint)</a></li>
                            <li><a href="index.html" class="nav-logout">Logout</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="container main-content">
        
        <div class="row">
            <div class="col-12">
                <h1>GameJoint</h1>
                <span class="release-date">Since March 2023</span>
            </div>
        </div>
        <hr>

        <div class="row mt-30 mb-30">
            <div class="col-12">
                <h4 class="font-weight-bold mb-15">Publication Overview in Games</h4>
                <div class="game-card overview-card">
                    <div class="overview-left">
                        <div id="avg-score" class="overview-score-large">-</div>
                        <div class="overview-label">Avg. Score</div>
                    </div>
                    <div class="overview-right">
                        <h6 class="overview-title">Score Distribution</h6>
                        <div class="mb-20">
                            <div class="dist-row">
                                <span class="dist-label">Positive</span>
                                <div class="dist-track">
                                    <div id="pos-bar" class="dist-fill bg-pos" style="width: 0%;"></div>
                                </div>
                                <span id="pos-count" class="dist-count">0</span>
                            </div>
                            <div class="dist-row">
                                <span class="dist-label">Mixed</span>
                                <div class="dist-track">
                                    <div id="mixed-bar" class="dist-fill bg-mix" style="width: 0%;"></div>
                                </div>
                                <span id="mixed-count" class="dist-count">0</span>
                            </div>
                            <div class="dist-row">
                                <span class="dist-label">Negative</span>
                                <div class="dist-track">
                                    <div id="neg-bar" class="dist-fill bg-neg" style="width: 0%;"></div>
                                </div>
                                <span id="neg-count" class="dist-count">0</span>
                            </div>
                        </div>
                        <hr class="divider-light">
                        <div class="row">
                            <div class="col-6">
                                <span class="high-low-label">Highest Score</span>
                                <div class="high-low-row">
                                    <div id="highest-score-val" class="metascore metascore-mini">-</div>
                                    <b id="highest-game-name" class="game-name-small">-</b>
                                </div>
                            </div>
                            <div class="col-6">
                                <span class="high-low-label">Lowest Score</span>
                                <div class="high-low-row">
                                    <div id="lowest-score-val" class="metascore metascore-mini">-</div>
                                    <b id="lowest-game-name" class="game-name-small">-</b>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>

        <div class="row">
            <div class="col-12">
                
                <div class="section-title-row">
                    <h3 class="h3-nomargin">My Reviews</h3>
                    
                    <div class="filter-group">
                        <select onchange="filterReviews('profile-review-list', this.value)" class="filter-select">
                            <option value="all">Show All</option>
                            <option value="green">Positive (Green)</option>
                            <option value="yellow">Mixed (Yellow)</option>
                            <option value="red">Negative (Red)</option>
                        </select>

                        <select onchange="sortReviews('profile-review-list', this.value)" class="filter-select">
                            <option value="desc">Best Score</option>
                            <option value="asc">Worst Score</option>
                            <option value="date-desc">Newest First</option>
                            <option value="date-asc">Oldest First</option>
                        </select>
                    </div>
                </div>

                <div id="profile-review-list">
                    
                    <div class="game-card review-item review-item-auto" data-score="95">
                        <div class="card-content">
                            <div class="review-date-small">DEC 12, 2023</div>
                            <div class="review-item-header">
                                <div class="metascore mr-10">95</div>
                                <span class="review-game-title review-title-large">God of War RagnarÃ¶k</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                An absolute masterpiece of storytelling and combat. Kratos and Atreus' journey is emotional, the worlds are stunningly beautiful, and the gameplay is refined to perfection. A fitting end to the Norse saga.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">PS5</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="98">
                        <div class="card-content">
                            <div class="review-date-small">MAY 15, 2023</div>
                            <div class="review-item-header">
                                <div class="metascore mr-10">98</div>
                                <span class="review-game-title review-title-large">The Legend of Zelda: Tears of the Kingdom</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                Nintendo has done it again. The freedom to build and explore is unparalleled. Every corner of Hyrule feels alive with secrets. The new Ultrahand ability changes everything we know about puzzle solving.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">SWITCH</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="80">
                        <div class="card-content">
                            <div class="review-date-small">SEP 06, 2023</div>
                            <div class="review-item-header">
                                <div class="metascore mr-10">80</div>
                                <span class="review-game-title review-title-large">Starfield</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                Ambitious in scale but hindered by outdated mechanics and frequent loading screens. Space exploration feels disjointed. However, the ship building and faction quests are quite engaging if you have the patience.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">PC, XBOX</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="90">
                        <div class="card-content">
                            <div class="review-date-small">FEB 24, 2024</div>
                            <div class="review-item-header">
                                <div class="metascore mr-10">90</div>
                                <span class="review-game-title review-title-large">Hollow Knight</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                A masterclass in atmosphere and level design. The combat is tight, responsive, and challenging. Hallownest is a joy to get lost in, filled with melancholic beauty and tough bosses.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">MULTI</span>
                            </div>
                        </div>
                    </div>

                    <div class="game-card review-item review-item-auto" data-score="35">
                        <div class="card-content">
                            <div class="review-date-small">MAY 25, 2023</div>
                            <div class="review-item-header">
                                <div class="metascore mr-10">35</div>
                                <span class="review-game-title review-title-large">The Lord of the Rings: Gollum</span>
                            </div>
                            <p class="text-collapsed review-body-text">
                                A tragic waste of a great license. Controls are clunky, graphics look dated, and the story adds nothing meaningful to the lore. Avoid at all costs.
                            </p>
                            <button class="btn-read-more">Read More</button>
                            <div class="card-footer-profile">
                                <a href="#" class="footer-link-small">FULL REVIEW ðŸ”—</a>
                                <span class="footer-tag-small">PC, PS5</span>
                            </div>
                        </div>
                    </div>

                </div>
                
                <div class="text-center mt-30">
                    <button class="btn-show-more" data-target="profile-review-list">Show More Reviews</button>
                </div>
            </div>
        </div>
    </div>

    <div id="full-review-modal" class="modal-overlay">
        <div class="modal-content modal-content-profile">
            <span class="close-full-review-btn modal-close-right">&times;</span>
            <div class="modal-review-header">
                <div id="modal-review-score" class="metascore mr-15"></div>
                <h3 id="modal-review-author" class="h3-nomargin">Game Title</h3>
            </div>
            <p id="modal-review-text" class="modal-text-content">Review text...</p>
            <div class="text-right mt-20">
                <button id="close-full-review-btn" class="btn-cancel" style="background: #333;">Close</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2024 GameJoint.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="assets/js/main.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            updateOverviewStats();
            
            if (typeof window.sortReviews === "function") {
                window.sortReviews('profile-review-list', 'date-desc');
            }
            
            const selects = document.querySelectorAll('select');
            selects.forEach(sel => {
                sel.addEventListener('change', () => {
                    setTimeout(updateOverviewStats, 100);
                });
            });
            
            initReadMoreButtons();
        });

        // Puan Renklendirme (Overview ve Modal iÃ§in)
        function applyColorToEl(el, score) {
            el.classList.remove('score-none', 'score-dark-green', 'score-green', 'score-yellow', 'score-red');
            let effective = score <= 10 ? score * 10 : score;
            if (effective >= 90) el.classList.add('score-dark-green');
            else if (effective >= 75) el.classList.add('score-green');
            else if (effective >= 50) el.classList.add('score-yellow');
            else el.classList.add('score-red');
        }

        // Overview Hesaplama (Kare puan kutularÄ± iÃ§in .metascore kullanÄ±ldÄ±)
        function updateOverviewStats() {
            const reviews = document.querySelectorAll('.review-item');
            
            let total = 0, pos = 0, mixed = 0, neg = 0, hi = -1, lo = 101, hiG = "-", loG = "-";
            let validCount = 0;

            reviews.forEach(r => {
                const s = parseInt(r.querySelector('.metascore').innerText);
                const tElement = r.querySelector('.review-game-title');
                const t = tElement ? tElement.innerText : "-";
                
                if (!isNaN(s)) {
                    total += s;
                    validCount++;
                    if (s >= 75) pos++; else if (s >= 50) mixed++; else neg++;
                    if (s > hi) { hi = s; hiG = t; }
                    if (s < lo) { lo = s; loG = t; }
                }
            });

            if (validCount > 0) {
                document.getElementById('avg-score').innerText = Math.round(total / validCount);
                document.getElementById('pos-count').innerText = pos;
                document.getElementById('mixed-count').innerText = mixed;
                document.getElementById('neg-count').innerText = neg;
                document.getElementById('pos-bar').style.width = (pos/validCount*100)+'%';
                document.getElementById('mixed-bar').style.width = (mixed/validCount*100)+'%';
                document.getElementById('neg-bar').style.width = (neg/validCount*100)+'%';
                
                const hiEl = document.getElementById('highest-score-val');
                const loEl = document.getElementById('lowest-score-val');
                hiEl.innerText = hi; loEl.innerText = lo;
                document.getElementById('highest-game-name').innerText = hiG;
                document.getElementById('lowest-game-name').innerText = loG;

                applyColorToEl(hiEl, hi);
                applyColorToEl(loEl, lo);
            }
        }

        function initReadMoreButtons() {
            const modal = document.getElementById('full-review-modal');
            const modalAuthor = document.getElementById('modal-review-author');
            const modalScore = document.getElementById('modal-review-score');
            const modalText = document.getElementById('modal-review-text');

            document.querySelectorAll('.btn-read-more').forEach(btn => {
                const p = btn.previousElementSibling;
                // Add check to make sure element exists
                if (p && p.scrollHeight > p.clientHeight + 5) {
                    btn.style.display = 'inline-block';
                } else {
                    btn.style.display = 'none';
                }

                btn.onclick = function(e) {
                    e.preventDefault();
                    const card = btn.closest('.game-card');
                    const title = card.querySelector('.review-game-title').textContent;
                    const score = card.querySelector('.metascore').textContent;

                    modalAuthor.textContent = title;
                    modalText.textContent = p.textContent.trim();
                    modalScore.textContent = score;
                    applyColorToEl(modalScore, parseInt(score));
                    modal.style.display = 'flex';
                };
            });

            const close = () => modal.style.display = 'none';
            if(document.querySelector('.close-full-review-btn')) document.querySelector('.close-full-review-btn').onclick = close;
            if(document.getElementById('close-full-review-btn')) document.getElementById('close-full-review-btn').onclick = close;
            window.onclick = (e) => { if (e.target == modal) close(); };
        }
    </script>
</body>
</html>